[2022-10-22 09:00:02,517] {taskinstance.py:1159} INFO - Dependencies all met for <TaskInstance: source_ingest_dag.source_ingestion_task scheduled__2022-10-22T08:00:00+00:00 [queued]>
[2022-10-22 09:00:02,538] {taskinstance.py:1159} INFO - Dependencies all met for <TaskInstance: source_ingest_dag.source_ingestion_task scheduled__2022-10-22T08:00:00+00:00 [queued]>
[2022-10-22 09:00:02,540] {taskinstance.py:1356} INFO - 
--------------------------------------------------------------------------------
[2022-10-22 09:00:02,541] {taskinstance.py:1357} INFO - Starting attempt 1 of 2
[2022-10-22 09:00:02,542] {taskinstance.py:1358} INFO - 
--------------------------------------------------------------------------------
[2022-10-22 09:00:02,562] {taskinstance.py:1377} INFO - Executing <Task(PythonOperator): source_ingestion_task> on 2022-10-22 08:00:00+00:00
[2022-10-22 09:00:02,568] {standard_task_runner.py:52} INFO - Started process 408 to run task
[2022-10-22 09:00:02,573] {standard_task_runner.py:79} INFO - Running: ['***', 'tasks', 'run', 'source_ingest_dag', 'source_ingestion_task', 'scheduled__2022-10-22T08:00:00+00:00', '--job-id', '8', '--raw', '--subdir', 'DAGS_FOLDER/source_ingest_dag.py', '--cfg-path', '/tmp/tmpg_cgx7w1', '--error-file', '/tmp/tmpaye4sseo']
[2022-10-22 09:00:02,574] {standard_task_runner.py:80} INFO - Job 8: Subtask source_ingestion_task
[2022-10-22 09:00:02,683] {logging_mixin.py:115} WARNING - /home/***/.local/lib/python3.7/site-packages/***/models/dagrun.py:485 SAWarning: TypeDecorator UtcDateTime(timezone=True) will not produce a cache key because the ``cache_ok`` attribute is not set to True.  This can have significant performance implications including some performance degradations in comparison to prior SQLAlchemy versions.  Set this attribute to True if this type object's state is safe to use in a cache key, or False to disable this warning. (Background on this error at: https://sqlalche.me/e/14/cprf)
[2022-10-22 09:00:02,697] {task_command.py:369} INFO - Running <TaskInstance: source_ingest_dag.source_ingestion_task scheduled__2022-10-22T08:00:00+00:00 [running]> on host 236209f5c3f9
[2022-10-22 09:00:02,756] {logging_mixin.py:115} WARNING - /home/***/.local/lib/python3.7/site-packages/***/models/dagrun.py:485 SAWarning: TypeDecorator UtcDateTime(timezone=True) will not produce a cache key because the ``cache_ok`` attribute is not set to True.  This can have significant performance implications including some performance degradations in comparison to prior SQLAlchemy versions.  Set this attribute to True if this type object's state is safe to use in a cache key, or False to disable this warning. (Background on this error at: https://sqlalche.me/e/14/cprf)
[2022-10-22 09:00:02,839] {logging_mixin.py:115} WARNING - /home/***/.local/lib/python3.7/site-packages/***/models/renderedtifields.py:213 SAWarning: TypeDecorator UtcDateTime(timezone=True) will not produce a cache key because the ``cache_ok`` attribute is not set to True.  This can have significant performance implications including some performance degradations in comparison to prior SQLAlchemy versions.  Set this attribute to True if this type object's state is safe to use in a cache key, or False to disable this warning. (Background on this error at: https://sqlalche.me/e/14/cprf)
[2022-10-22 09:00:02,853] {taskinstance.py:1571} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_EMAIL=rongshiu@gmail.com
AIRFLOW_CTX_DAG_OWNER=rongshiu@gmail.com
AIRFLOW_CTX_DAG_ID=source_ingest_dag
AIRFLOW_CTX_TASK_ID=source_ingestion_task
AIRFLOW_CTX_EXECUTION_DATE=2022-10-22T08:00:00+00:00
AIRFLOW_CTX_TRY_NUMBER=1
AIRFLOW_CTX_DAG_RUN_ID=scheduled__2022-10-22T08:00:00+00:00
[2022-10-22 09:00:02,856] {source_ingest.py:9} INFO - Getting source data
[2022-10-22 09:00:37,466] {source_ingest.py:13} INFO - Successfully get source data
[2022-10-22 09:00:37,474] {source_ingest.py:19} INFO - Uploading source data
[2022-10-22 09:02:13,500] {local_task_job.py:84} ERROR - Received SIGTERM. Terminating subprocesses
[2022-10-22 09:02:13,506] {process_utils.py:129} INFO - Sending Signals.SIGTERM to group 408. PIDs of all processes in the group: [408]
[2022-10-22 09:02:13,513] {process_utils.py:80} INFO - Sending the signal Signals.SIGTERM to group 408
[2022-10-22 09:02:13,670] {taskinstance.py:1541} ERROR - Received SIGTERM. Terminating subprocesses.
[2022-10-22 09:02:13,674] {taskinstance.py:1889} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 1418, in run_transaction
    yield tx
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 967, in insert
    exec_insert(conn, keys, chunk_iter)
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 893, in _execute_insert_multi
    conn.execute(self.table.insert(data))
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1380, in execute
    return meth(self, multiparams, params, _EMPTY_EXECUTION_OPTS)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/elements.py", line 334, in _execute_on_connection
    self, multiparams, params, execution_options
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1570, in _execute_clauseelement
    linting=self.dialect.compiler_linting | compiler.WARN_LINTING,
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/elements.py", line 550, in _compile_w_cache
    **kw
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/elements.py", line 566, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/compiler.py", line 790, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/compiler.py", line 463, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/compiler.py", line 498, in process
    return obj._compiler_dispatch(self, **kwargs)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/visitors.py", line 82, in _compiler_dispatch
    return meth(self, **kw)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/compiler.py", line 3876, in visit_insert
    self, insert_stmt, compile_state, **kw
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/crud.py", line 181, in _get_crud_params
    kw,
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/crud.py", line 961, in _extend_values_for_multiparams
    row[key],
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/models/taskinstance.py", line 1543, in signal_handler
    raise AirflowException("Task received SIGTERM signal")
airflow.exceptions.AirflowException: Task received SIGTERM signal

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1057, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/default.py", line 682, in do_rollback
    dbapi_connection.rollback()
psycopg2.errors.AdminShutdown: terminating connection due to administrator command
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/opt/airflow/dags/source_ingest.py", line 22, in source_ingest
    chunksize=10000, schema='public')
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/core/generic.py", line 2882, in to_sql
    method=method,
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 728, in to_sql
    **engine_kwargs,
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 1770, in to_sql
    **engine_kwargs,
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 1350, in insert_records
    raise err
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 1340, in insert_records
    table.insert(chunksize=chunksize, method=method)
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 967, in insert
    exec_insert(conn, keys, chunk_iter)
  File "/usr/local/lib/python3.7/contextlib.py", line 130, in __exit__
    self.gen.throw(type, value, traceback)
  File "/home/airflow/.local/lib/python3.7/site-packages/pandas/io/sql.py", line 1420, in run_transaction
    yield self.connectable
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 3100, in __exit__
    self.transaction.__exit__(type_, value, traceback)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/util.py", line 249, in __exit__
    self.rollback()
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 2438, in rollback
    self._do_rollback()
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 2642, in _do_rollback
    self._close_impl(try_deactivate=True)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 2625, in _close_impl
    self._connection_rollback_impl()
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 2617, in _connection_rollback_impl
    self.connection._rollback_impl()
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1059, in _rollback_impl
    self._handle_dbapi_exception(e, None, None, None, None)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 2125, in _handle_dbapi_exception
    sqlalchemy_exception, with_traceback=exc_info[2], from_=e
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/util/compat.py", line 208, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1057, in _rollback_impl
    self.engine.dialect.do_rollback(self.connection)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/default.py", line 682, in do_rollback
    dbapi_connection.rollback()
sqlalchemy.exc.OperationalError: (psycopg2.errors.AdminShutdown) terminating connection due to administrator command
server closed the connection unexpectedly
	This probably means the server terminated abnormally
	before or while processing the request.

(Background on this error at: https://sqlalche.me/e/14/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/operators/python.py", line 171, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/operators/python.py", line 189, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/source_ingest.py", line 25, in source_ingest
    logger.error('source_ingest pipeline failed due to {error}',error=e)
  File "/usr/local/lib/python3.7/logging/__init__.py", line 1407, in error
    self._log(ERROR, msg, args, **kwargs)
TypeError: _log() got an unexpected keyword argument 'error'
[2022-10-22 09:02:13,732] {taskinstance.py:1400} INFO - Marking task as UP_FOR_RETRY. dag_id=source_ingest_dag, task_id=source_ingestion_task, execution_date=20221022T080000, start_date=20221022T090002, end_date=20221022T090213
[2022-10-22 09:02:13,788] {standard_task_runner.py:97} ERROR - Failed to execute job 8 for task source_ingestion_task (_log() got an unexpected keyword argument 'error'; 408)
[2022-10-22 09:02:13,955] {process_utils.py:75} INFO - Process psutil.Process(pid=408, status='terminated', exitcode=1, started='09:00:01') (408) terminated with exit code 1
[2022-10-22 09:02:13,957] {local_task_job.py:156} INFO - Task exited with return code 143
[2022-10-22 09:02:14,091] {local_task_job.py:273} INFO - 0 downstream tasks scheduled from follow-on schedule check
[2022-10-22 09:06:12,922] {taskinstance.py:1159} INFO - Dependencies all met for <TaskInstance: source_ingest_dag.source_ingestion_task scheduled__2022-10-22T08:00:00+00:00 [queued]>
[2022-10-22 09:06:12,963] {taskinstance.py:1159} INFO - Dependencies all met for <TaskInstance: source_ingest_dag.source_ingestion_task scheduled__2022-10-22T08:00:00+00:00 [queued]>
[2022-10-22 09:06:12,967] {taskinstance.py:1356} INFO - 
--------------------------------------------------------------------------------
[2022-10-22 09:06:12,970] {taskinstance.py:1357} INFO - Starting attempt 1 of 2
[2022-10-22 09:06:12,972] {taskinstance.py:1358} INFO - 
--------------------------------------------------------------------------------
[2022-10-22 09:06:13,029] {taskinstance.py:1377} INFO - Executing <Task(PythonOperator): source_ingestion_task> on 2022-10-22 08:00:00+00:00
[2022-10-22 09:06:13,058] {standard_task_runner.py:52} INFO - Started process 247 to run task
[2022-10-22 09:06:13,064] {standard_task_runner.py:79} INFO - Running: ['***', 'tasks', 'run', 'source_ingest_dag', 'source_ingestion_task', 'scheduled__2022-10-22T08:00:00+00:00', '--job-id', '2', '--raw', '--subdir', 'DAGS_FOLDER/source_ingest_dag.py', '--cfg-path', '/tmp/tmpjui_fl0g', '--error-file', '/tmp/tmp2xqhrf41']
[2022-10-22 09:06:13,066] {standard_task_runner.py:80} INFO - Job 2: Subtask source_ingestion_task
[2022-10-22 09:06:13,190] {logging_mixin.py:115} WARNING - /home/***/.local/lib/python3.7/site-packages/***/models/dagrun.py:485 SAWarning: TypeDecorator UtcDateTime(timezone=True) will not produce a cache key because the ``cache_ok`` attribute is not set to True.  This can have significant performance implications including some performance degradations in comparison to prior SQLAlchemy versions.  Set this attribute to True if this type object's state is safe to use in a cache key, or False to disable this warning. (Background on this error at: https://sqlalche.me/e/14/cprf)
[2022-10-22 09:06:13,201] {task_command.py:369} INFO - Running <TaskInstance: source_ingest_dag.source_ingestion_task scheduled__2022-10-22T08:00:00+00:00 [running]> on host caa16abb6ce3
[2022-10-22 09:06:13,262] {logging_mixin.py:115} WARNING - /home/***/.local/lib/python3.7/site-packages/***/models/dagrun.py:485 SAWarning: TypeDecorator UtcDateTime(timezone=True) will not produce a cache key because the ``cache_ok`` attribute is not set to True.  This can have significant performance implications including some performance degradations in comparison to prior SQLAlchemy versions.  Set this attribute to True if this type object's state is safe to use in a cache key, or False to disable this warning. (Background on this error at: https://sqlalche.me/e/14/cprf)
[2022-10-22 09:06:13,351] {logging_mixin.py:115} WARNING - /home/***/.local/lib/python3.7/site-packages/***/models/renderedtifields.py:213 SAWarning: TypeDecorator UtcDateTime(timezone=True) will not produce a cache key because the ``cache_ok`` attribute is not set to True.  This can have significant performance implications including some performance degradations in comparison to prior SQLAlchemy versions.  Set this attribute to True if this type object's state is safe to use in a cache key, or False to disable this warning. (Background on this error at: https://sqlalche.me/e/14/cprf)
[2022-10-22 09:06:13,367] {taskinstance.py:1571} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_EMAIL=rongshiu@gmail.com
AIRFLOW_CTX_DAG_OWNER=rongshiu@gmail.com
AIRFLOW_CTX_DAG_ID=source_ingest_dag
AIRFLOW_CTX_TASK_ID=source_ingestion_task
AIRFLOW_CTX_EXECUTION_DATE=2022-10-22T08:00:00+00:00
AIRFLOW_CTX_TRY_NUMBER=1
AIRFLOW_CTX_DAG_RUN_ID=scheduled__2022-10-22T08:00:00+00:00
[2022-10-22 09:06:13,370] {source_ingest.py:9} INFO - Getting source data
[2022-10-22 09:06:44,479] {source_ingest.py:13} INFO - Successfully get source data
[2022-10-22 09:06:44,485] {source_ingest.py:19} INFO - Uploading source data
[2022-10-22 09:12:09,335] {source_ingest.py:23} INFO - Successfully uploaded source data
[2022-10-22 09:12:09,360] {python.py:173} INFO - Done. Returned value was: None
[2022-10-22 09:12:09,387] {taskinstance.py:1400} INFO - Marking task as SUCCESS. dag_id=source_ingest_dag, task_id=source_ingestion_task, execution_date=20221022T080000, start_date=20221022T090612, end_date=20221022T091209
[2022-10-22 09:12:09,460] {local_task_job.py:156} INFO - Task exited with return code 0
[2022-10-22 09:12:09,531] {local_task_job.py:273} INFO - 0 downstream tasks scheduled from follow-on schedule check
